<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Tank Log</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    h2 {
      text-align: center;
    }
  </style>
</head>
<body>
<h2>üíß Water Tank Log</h2>
<form id="waterForm">
  <input type="text" id="flockId" name="flockId" readonly>
  <input type="date" id="date" name="date" required>
  <input type="time" id="time" name="time" required>

  <input type="number" id="waterLevel" name="waterLevel" placeholder="Fill Level (%)" required>
  <input type="number" id="litersRemaining" name="litersRemaining" placeholder="Liters Remaining (auto)" readonly>
  <input type="number" id="dailyRequirement" name="dailyRequirement" placeholder="Daily Water Requirement (L)" readonly>
  <input type="number" id="daysRemaining" name="daysRemaining" placeholder="Estimated Days Remaining" readonly>

  <input type="text" name="submittedBy" placeholder="Submitted by" required>
  <button type="submit">Submit</button>
</form>
<p id="msg" style="text-align:center; font-weight:bold;"></p>

<script>
  const form = document.getElementById('waterForm');
  const flockInput = document.getElementById('flockId');
  const dateInput = document.getElementById('date');
  const timeInput = document.getElementById('time');
  const waterLevelInput = document.getElementById('waterLevel');
  const litersInput = document.getElementById('litersRemaining');
  const dailyReqInput = document.getElementById('dailyRequirement');
  const daysRemainInput = document.getElementById('daysRemaining');
  const msg = document.getElementById('msg');

  const dailyWaterNeed = 2400 * 0.112; // 268.8L
  dailyReqInput.value = dailyWaterNeed;

  // Autofill date and time
  const now = new Date();
  dateInput.valueAsDate = now;
  timeInput.value = now.toTimeString().slice(0,5);

  // Get Flock from URL
  const params = new URLSearchParams(window.location.search);
  const flock = params.get('flock');
  if (flock) flockInput.value = flock;

  // Calculate on input
  waterLevelInput.addEventListener('input', () => {
    const level = parseFloat(waterLevelInput.value);
    if (!isNaN(level)) {
      const liters = (level / 100) * 1000;
      litersInput.value = liters.toFixed(1);
      daysRemainInput.value = (liters / dailyWaterNeed).toFixed(1);
    } else {
      litersInput.value = '';
      daysRemainInput.value = '';
    }
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(form).entries());

    try {
      await fetch("https://script.google.com/macros/s/AKfycbzd_hPSBnFLuLZZsgJMPYpq5FAqMuw3ovqU02dfjH-zO1oKy36xtkH4j7R7H1cmI3hH/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      msg.textContent = "‚úÖ Submitted Successfully!";
      form.reset();
    } catch (err) {
      msg.textContent = "‚ùå Failed to submit.";
    }
  });
</script>
</body>
</html>
